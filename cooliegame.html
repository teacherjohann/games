<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Nanyang Passage ‚Äî Goh Pek Teck</title>

<!-- Historical-feeling fonts: IM Fell for headings, Spectral for body -->
<link href="https://fonts.googleapis.com/css2?family=IM+Fell+English:ital,wght@0,400;1,400&family=Spectral:ital,wght@0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">

<style>
  :root{
    --sg-red:#EF3340;       /* Singapore flag red */
    --sg-white:#ffffff;
    --sg-dark:#0b0d12;
    --sg-gold:#C3A54B;
    --sg-teal:#1A9C9C;
    --ink:#1b1e23;
    --muted:#5d626c;
    --bg:#f7f7f8;
    --card:#ffffff;
    --focus:#0b6cff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: "Spectral", Georgia, "Times New Roman", serif;
    color:var(--ink);
    background:
      radial-gradient(1200px 600px at 10% -10%, rgba(239,51,64,.08), transparent 50%),
      radial-gradient(1200px 600px at 110% -10%, rgba(195,165,75,.08), transparent 50%),
      var(--bg);
  }
  header{
    background: linear-gradient(135deg, var(--sg-red), #cc0e1c);
    color:var(--sg-white);
    padding:18px 20px;
    display:flex; align-items:center; justify-content:space-between;
  }
  header h1{
    margin:0; font-size:1.2rem; letter-spacing:.2px; display:flex; gap:.6rem; align-items:center;
    font-family: "IM Fell English", Georgia, serif;
  }
  header h1 .mark{
    display:inline-grid; place-items:center; width:30px; height:30px; border-radius:50%;
    background:var(--sg-white); color:var(--sg-red); font-size:16px; font-weight:700;
  }
  header .meta{font-size:.9rem; opacity:.95}
  main{ max-width:980px; margin:24px auto; padding:0 16px 48px; }

  .card{
    background:var(--card);
    border:1px solid #e9eaee;
    border-radius:16px;
    box-shadow:0 10px 30px rgba(21,25,37,.06);
    overflow:hidden;
  }

  .media{
    width:100%; aspect-ratio: 21/9; background:#f2f3f6;
    display:grid; place-items:center; overflow:hidden; border-bottom:1px solid #eceff3;
  }
  .media img{
    width:100%; height:100%; object-fit:cover; display:block;
  }
  .media .fallback-emoji{
    font-size:60px; opacity:.7;
  }
  figure{ margin:0; position:relative; width:100%; height:100%; }
  figcaption{
    position:absolute; left:0; right:0; bottom:0;
    background: linear-gradient(to top, rgba(0,0,0,.5), rgba(0,0,0,0));
    color:#fff; padding:10px 14px; font-size:.9rem;
    text-shadow:0 1px 2px rgba(0,0,0,.6);
  }

  .scene{ padding:22px; }
  .scene h2{
    margin:0 0 6px 0; font-size:1.35rem; color:var(--sg-red);
    font-family: "IM Fell English", Georgia, serif;
  }
  .scene .subtitle{ color:var(--muted); font-size:.95rem; margin-bottom:12px; }
  .scene p{ line-height:1.6; margin:10px 0; font-size:1.03rem; }

  .choices{
    display:grid; gap:10px; grid-template-columns:1fr; padding:0 22px 22px 22px;
  }
  .option{
    display:flex; gap:12px; align-items:flex-start;
    border:2px solid var(--sg-red); border-radius:12px;
    padding:12px 14px;
    background:var(--sg-white);
    color:var(--ink);
    text-align:left;
    cursor:pointer;
    transition:.15s transform ease, .15s background ease, .15s border-color ease;
    outline: none;
  }
  .option:hover{ transform: translateY(-1px); background:#fff5f6; }
  .option:focus{ box-shadow:0 0 0 3px rgba(11,108,255,.25); }

  .badge{
    min-width:34px; height:34px; border-radius:10px;
    display:grid; place-items:center; font-size:18px; color:#fff;
    flex:0 0 34px; font-weight:700;
  }
  .tone-red   { border-color:var(--sg-red);   }
  .tone-gold  { border-color:var(--sg-gold);  }
  .tone-teal  { border-color:var(--sg-teal);  }
  .tone-red .badge  { background:var(--sg-red); }
  .tone-gold .badge { background:var(--sg-gold); color:#111;}
  .tone-teal .badge { background:var(--sg-teal); }

  .opt-text{ font-size:1rem; }
  .delta{ font-size:.92rem; color:var(--muted); margin-top:4px; display:flex; gap:8px; flex-wrap:wrap; }

  .hud{
    padding:14px 22px 20px 22px; border-top:1px dashed #e6e7ec; display:grid; gap:10px;
  }
  .bars{ display:grid; gap:10px; grid-template-columns:1fr; }
  .bar{ display:grid; gap:6px; }
  .bar label{ font-size:.93rem; color:var(--muted); display:flex; align-items:center; gap:8px;}
  .track{ height:12px; background:#eef0f4; border-radius:999px; overflow:hidden; border:1px solid #e1e4ea;}
  .fill{ height:100%; background: linear-gradient(90deg, var(--sg-red), #ff6a72); border-right:1px solid rgba(0,0,0,.08); width:0%; transition: width .3s ease; }
  .fill.fatigue{ background: linear-gradient(90deg, #1f2843, #344053); }
  .fill.bro{ background: linear-gradient(90deg, #1A9C9C, #41c3c3); }

  .footer{
    padding:14px 22px 22px 22px; display:flex; justify-content:space-between; align-items:center; color:var(--muted); font-size:.9rem;
  }
  .pill{
    display:inline-flex; align-items:center; gap:8px; background:#fff;
    border:1px solid #e6e7ec; padding:6px 10px; border-radius:999px;
  }
  .btn{
    padding:10px 14px; border-radius:10px; border:1px solid transparent;
    background:var(--sg-red); color:#fff; cursor:pointer; font-weight:600;
  }
  .btn.secondary{ background:#fff; color:var(--sg-red); border-color:var(--sg-red); }
  .center{ text-align:center; padding:22px; opacity:.85; font-size:.9rem; }

  @media (min-width:720px){
    .choices{ grid-template-columns:1fr 1fr; }
  }
</style>
</head>
<body>
<header aria-label="Game identity">
  <h1><span class="mark">‚òæ‚òÖ</span> Nanyang Passage ‚Äî Goh Pek Teck</h1>
  <div class="meta"><span id="step">Prologue</span> ¬∑ üá∏üá¨ Red & White UI ¬∑ Historical font</div>
</header>

<main>
  <section class="card" role="region" aria-live="polite" aria-atomic="true">
    <div class="media" aria-hidden="false">
      <figure>
        <img id="sceneImg" alt="Illustration of setting" src="" onerror="this.style.display='none'; document.getElementById('imgFallback').style.display='grid';">
        <div id="imgFallback" class="fallback-emoji" style="display:none;">üö£‚Äç‚ôÇÔ∏è</div>
        <figcaption id="imgCaption">A sampan nudges a muddy bank as dawn thins the mist.</figcaption>
      </figure>
    </div>

    <div class="scene">
      <h2 id="title">Prologue ‚Äî Fujian, 1822</h2>
      <div class="subtitle" id="subtitle">Push factors ¬∑ clans, hunger, and hard soil</div>
      <p id="text">
        Smoke curls above the village as two clans trade threats across the paddy. The harvest failed; rice jars echo hollow. Debts press like stones.
        You are Goh Pek Teck, nimble but boh lui (no money). Rumours speak of Nanyang (Singapore): wages paid in silver, work siong (tough) yet steady.
        Your mother‚Äôs hands shake as she folds your shirt; the road ahead smells of salt and risk. Aiyo (oh dear), which path will you choose?
      </p>
    </div>

    <div class="choices" id="choices"></div>

    <div class="hud" id="hud">
      <div class="bars">
        <div class="bar">
          <label>Wealth üí∞</label>
          <div class="track"><div class="fill wealth" id="wFill"></div></div>
        </div>
        <div class="bar">
          <label>Fatigue üòì</label>
          <div class="track"><div class="fill fatigue" id="fFill"></div></div>
        </div>
        <div class="bar">
          <label>Brotherhood ü§ù</label>
          <div class="track"><div class="fill bro" id="bFill"></div></div>
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="pill">Event <strong id="evNum">1</strong>/6</div>
      <div class="pill">Press <strong>1‚Äì4</strong> to choose</div>
    </div>
  </section>

  <div class="center">
    Design: Singapore red/white with gold & teal accents ¬∑ Accessible contrast ¬∑ Emoji-first UI
  </div>
</main>

<script>
/* ---------- IMAGE MAP (place your files in ./assets/) ----------
   Put images in an 'assets' folder at your repo root (works with GitHub Pages).
   If a file is missing, a big emoji appears as a fallback.
   Update captions/alt text as needed.
----------------------------------------------------------------- */
const images = {
  1: { src: "./assets/fujian-village.jpg", alt: "Fujian village fields with smoky air and poor harvest", cap: "Fujian fields after a poor harvest, tempers rising between clans." },
  2: { src: "./assets/junk-south-china-sea.jpg", alt: "South China Sea junk with crowded deck", cap: "A crowded junk rides the swells of the South China Sea." },
  3: { src: "./assets/sampan-boat-quay.jpg", alt: "Sampans at a muddy quay with early shophouses", cap: "Sampans knock against the bank as Boat Quay wakes." },
  4: { src: "./assets/kongsi-house.jpg", alt: "Crowded kongsi lodging with bowls and mats", cap: "A kongsi house where bowls, stories, and worries are shared." },
  5: { src: "./assets/godown-scales.jpg", alt: "Godown interior with pepper sacks and balance scale", cap: "A godown‚Äôs silver scales and pepper-scented air." },
  6: { src: "./assets/telok-ayer-temple.jpg", alt: "Small temple works at Telok Ayer with workers", cap: "Workers chip stone near a small temple at Telok Ayer." },
  epilogue: { src: "./assets/modest-bunk.jpg", alt: "Modest bunk with folded shirt and coin pouch", cap: "A modest bunk, a small pouch of silver, and quiet breath." }
};

function setImageFor(stepKey){
  const img = document.getElementById('sceneImg');
  const fallback = document.getElementById('imgFallback');
  const cap = document.getElementById('imgCaption');
  const meta = images[stepKey] || images[1];
  if(!meta || !meta.src){ img.removeAttribute('src'); fallback.style.display='grid'; cap.textContent = "‚Äî"; return; }
  fallback.style.display='none';
  img.style.display='block';
  img.src = meta.src;
  img.alt = meta.alt || "Scene illustration";
  cap.textContent = meta.cap || "";
}

/* ---------- STATE ---------- */
const state = {
  wealth: 2,      // 0‚Äì10
  fatigue: 2,     // 0‚Äì10
  brotherhood: 0, // 0‚Äì10
  step: 1,
  flags: {
    usedAgent: false,
    borrowedFamily: false,
    job: null,             // 'dock','carpenter','godown'
    joinedSociety: false,
    joinedKongsi: false,
    sentRemittance: false
  }
};

function clamp(v,min=0,max=10){ return Math.max(min, Math.min(max, v)); }

/* ---------- EVENTS (exactly 6) ----------
   Choices are now FULL SENTENCES with clear foreshadowing.
------------------------------------------ */
const events = [
  {
    id:1,
    title:"Prologue ‚Äî Fujian, 1822",
    subtitle:"Push factors ¬∑ clans, hunger, and hard soil",
    text:`Smoke curls above the village as two clans trade threats across the paddy. The harvest failed; rice jars echo hollow.
Debts press like stones. You are Goh Pek Teck, nimble but boh lui (no money). Rumours speak of Nanyang (Singapore): wages paid in silver,
work siong (tough) yet steady. Your mother folds your shirt; the road ahead smells of salt and risk. Aiyo (oh dear), which path will you choose?`,
    choices:[
      { label:"I will hire a coolie agent so that the passage is safer, even if I must pay a fee.",
        tone:"red", delta:{wealth:-1,fatigue:-1,brotherhood:0}, set:{usedAgent:true}, next:2 },
      { label:"I will borrow from my kin, accepting a family debt so that I can leave sooner.",
        tone:"gold", delta:{wealth:0,fatigue:0,brotherhood:1}, set:{borrowedFamily:true}, next:2 },
      { label:"I will work one more season to scrape together coins, even though the feud may flare.",
        tone:"teal", delta:{wealth:+1,fatigue:+1,brotherhood:0}, set:{}, next:2 }
    ]
  },
  {
    id:2,
    title:"South China Sea ‚Äî The Passage",
    subtitle:"Crowded junk, tar and salt, stars for pillows",
    text:`You board a creaking junk packed with men and hope. The sea heaves; someone retches by the rail.
The agent shouts tall promises; the helmsman ties another knot. Night winds bite. You count your coins and think of home.`,
    choices:[
      { label:"I will take deck passage to save silver, even though I must endure rough sleep in the wind.",
        tone:"red", delta:{wealth:+0,fatigue:+2,brotherhood:0}, set:{}, next:3 },
      { label:"I will work for my passage by swabbing decks so that I can save more coin despite the extra strain.",
        tone:"gold", delta:{wealth:+1,fatigue:+3,brotherhood:0}, set:{}, next:3 },
      { label:"I will use the agent‚Äôs small bunk to rest a little, since I hired him earlier.",
        tone:"teal", delta:{wealth:-1,fatigue:+1,brotherhood:0}, set:{}, next:3, require:(s)=>s.flags.usedAgent===true }
    ],
    fallback:{ label:"I will remain on the open deck because I do not have an agent‚Äôs bunk to claim.",
               tone:"teal", delta:{wealth:0,fatigue:+2,brotherhood:0}, set:{}, next:3 }
  },
  {
    id:3,
    title:"Nanyang (Singapore) ‚Äî First Footfall",
    subtitle:"Boat Quay wakes; coolies call, sampans bump and sigh",
    text:`You step onto a muddy bank where tongues mix like spices. Overseers clap and point: load, lift, carry.
A godown smells of pepper; carpenters sing to the beat of saws. Work is plenty, but bones will pay the price.`,
    choices:[
      { label:"I will work as a dock coolie so that I earn hard pay, even if my back must carry the cost.",
        tone:"red", delta:{wealth:+2,fatigue:+2,brotherhood:0}, set:{job:'dock'}, next:4 },
      { label:"I will become a carpenter‚Äôs apprentice so that I learn a skill, although my coin will grow more slowly.",
        tone:"gold", delta:{wealth:+1,fatigue:+1,brotherhood:0}, set:{job:'carpenter'}, next:4 },
      { label:"I will porter pepper in the spice godown so that my lifts are steady, even if the dust stings.",
        tone:"teal", delta:{wealth:+1,fatigue:+2,brotherhood:0}, set:{job:'godown'}, next:4 }
    ]
  },
  {
    id:4,
    title:"Night Lodging ‚Äî Brotherhood or Solitude",
    subtitle:"Attap roof, shared rice, whispers of protection",
    text:`In a crowded kongsi house, bowls clink. Some brothers speak of a society that guards newcomers.
They promise help in quarrels and funerals, not vice. Others say keep your head down; the police watch.`,
    choices:[
      { label:"I will join the secret society for protection and rites, while keeping clear of vice.",
        tone:"red", delta:{wealth:0,fatigue:0,brotherhood:+3}, set:{joinedSociety:true}, next:5 },
      { label:"I will remain independent so that I avoid entanglements, even if it means a lonelier road.",
        tone:"gold", delta:{wealth:0,fatigue:+1,brotherhood:0}, set:{}, next:5 },
      { label:"I will join my clan‚Äôs kongsi so that we can share dues, bowls, and shoulders in hard times.",
        tone:"teal", delta:{wealth:-1,fatigue:0,brotherhood:+2}, set:{joinedKongsi:true}, next:5 }
    ]
  },
  {
    id:5,
    title:"Head Tax & Wages ‚Äî Choices of Bread",
    subtitle:"Overseer‚Äôs tally, silver scales, and murmurs of fairness",
    text:`The head tax bites. Overseers push for faster hands. Some brothers whisper of a petition for fair rates.
A letter from home begs for remittance. Your back complains; the ledger does not.`,
    choices:[
      { label:"I will take extra shifts so that I can meet the tax quickly, even if my body grinds on.",
        tone:"red", delta:{wealth:+2,fatigue:+2,brotherhood:0}, set:{}, next:6 },
      { label:"I will sign a petition with backing so that we speak as one, since I have brothers to stand with me.",
        tone:"gold", delta:{wealth:+1,fatigue:+1,brotherhood:+1}, set:{}, next:6, require:(s)=> (s.brotherhood>=2) },
      { label:"I will send a remittance home so that my family‚Äôs burden lightens, even if my pouch grows thin.",
        tone:"teal", delta:{wealth:-1,fatigue:0,brotherhood:+1}, set:{sentRemittance:true}, next:6 }
    ],
    fallback:{ label:"I will work quietly and keep my head down because I lack backing for a petition.",
               tone:"gold", delta:{wealth:+1,fatigue:+1,brotherhood:0}, set:{}, next:6 }
  },
  {
    id:6,
    title:"Aching Bones ‚Äî Health and Community",
    subtitle:"Sinseh‚Äôs herbs, stubborn pride, and a temple bell",
    text:`Your shoulders burn like charcoal. A sinseh offers heated cups and bitter tea.
Workers chip at stone for a small temple at Telok Ayer. Coins are thin; time is thinner.`,
    choices:[
      { label:"I will visit the sinseh to treat my back, even if I must part with silver.",
        tone:"red", delta:{wealth:-1,fatigue:-1,brotherhood:0}, set:{}, next:"epilogue" },
      { label:"I will push through one more load so that I bring home a little more coin today.",
        tone:"gold", delta:{wealth:+1,fatigue:+2,brotherhood:0}, set:{}, next:"epilogue" },
      { label:"I will give a small coin to the temple so that I help build a place for our community.",
        tone:"teal", delta:{wealth:-1,fatigue:0,brotherhood:+1}, set:{}, next:"epilogue" }
    ]
  }
];

/* ---------- RENDERING ---------- */
const titleEl = document.getElementById('title');
const subtitleEl = document.getElementById('subtitle');
const textEl = document.getElementById('text');
const choicesEl = document.getElementById('choices');
const stepEl = document.getElementById('step');
const evNumEl = document.getElementById('evNum');
let wFill = document.getElementById('wFill');
let fFill = document.getElementById('fFill');
let bFill = document.getElementById('bFill');

function applyDelta(delta){
  if(!delta) return;
  state.wealth     = clamp(state.wealth + (delta.wealth??0));
  state.fatigue    = clamp(state.fatigue + (delta.fatigue??0));
  state.brotherhood= clamp(state.brotherhood + (delta.brotherhood??0));
}

function setFlags(set){
  if(!set) return;
  Object.entries(set).forEach(([k,v])=>{
    if(k in state.flags){ state.flags[k]=v; }
    else if(k==='job'){ state.flags.job=v; }
  });
}

function choiceChip(delta){
  const parts=[];
  if(delta?.wealth)     parts.push((delta.wealth>0?`+${delta.wealth}`:delta.wealth)+"üí∞");
  if(delta?.fatigue)    parts.push((delta.fatigue>0?`+${delta.fatigue}`:delta.fatigue)+"üòì");
  if(delta?.brotherhood)parts.push((delta.brotherhood>0?`+${delta.brotherhood}`:delta.brotherhood)+"ü§ù");
  return parts.length? parts.join(" ¬∑ ") : "No immediate change";
}

function setBars(){
  wFill.style.width = (state.wealth*10)+"%";
  fFill.style.width = (state.fatigue*10)+"%";
  bFill.style.width = (state.brotherhood*10)+"%";
}

function toneClass(i){
  return ['tone-red','tone-gold','tone-teal','tone-red'][i%4];
}

function buildOption(idx, label, tone, delta, handler){
  const btn = document.createElement('button');
  btn.className = `option ${tone}`;
  btn.innerHTML = `
    <span class="badge">${['1Ô∏è‚É£','2Ô∏è‚É£','3Ô∏è‚É£','4Ô∏è‚É£'][idx]}</span>
    <div class="opt-text">
      <div>${label}</div>
      <div class="delta">${choiceChip(delta)}</div>
    </div>`;
  btn.addEventListener('click', handler);
  return btn;
}

function renderEvent(id){
  const ev = events.find(e=>e.id===id);
  state.step = id;
  stepEl.textContent = id===1? "Prologue" : `Event ${id}`;
  evNumEl.textContent = id;

  titleEl.textContent = ev.title;
  subtitleEl.textContent = ev.subtitle;
  textEl.textContent = ev.text;

  // Scene image
  setImageFor(id);

  // Build choice buttons, respecting require / fallback
  choicesEl.innerHTML = '';
  let idx=0;
  let gatedOut = false;
  ev.choices.forEach((c)=>{
    if(c.require && !c.require(state)){ gatedOut = true; return; }
    const btn = buildOption(idx, c.label, toneClass(idx), c.delta, ()=>handleChoice(c));
    choicesEl.appendChild(btn);
    idx++;
  });

  if(gatedOut && ev.fallback){
    const fb = ev.fallback;
    const btn = buildOption(idx, fb.label, toneClass(idx), fb.delta, ()=>handleChoice(fb));
    choicesEl.appendChild(btn);
    idx++;
  }

  setBars();
}

function handleChoice(choice){
  applyDelta(choice.delta);
  setFlags(choice.set);

  if(choice.next==="epilogue"){
    renderEpilogue();
    return;
  }
  renderEvent(choice.next);
}

/* ---------- EPILOGUE ---------- */
function renderEpilogue(){
  const {wealth, fatigue, brotherhood, flags} = state;
  const lines = [];

  lines.push(`Years pass in the heat and rain. Your hands grow corded; your back remembers every sack.`);
  if(flags.job==='carpenter'){
    lines.push(`You learn the grain of timber; the saw‚Äôs song brings steadier coin.`);
  } else if(flags.job==='dock'){
    lines.push(`Boat Quay‚Äôs cries live in your bones; tides and orders shape your days.`);
  } else if(flags.job==='godown'){
    lines.push(`In the spice godown, pepper dust clings; you lift, stack, and breathe careful.`);
  }

  if(flags.joinedSociety){
    lines.push(`Brotherhood shelters you in quarrels; you avoid vice, keeping ties for protection.`);
  } else if(flags.joinedKongsi){
    lines.push(`The clan kongsi lends bowls and shoulders when trouble knocks.`);
  } else {
    lines.push(`You keep to yourself, counting coins and quiet breaths.`);
  }

  if(wealth>=6 && fatigue>=6){
    lines.push(`You save a modest pouch of silver but carry aching bones. Stability, not comfort.`);
  } else if(wealth>=4 && brotherhood>=4){
    lines.push(`With friends and careful saving, you share a decent bunk and send home small remittances.`);
  } else if(wealth<3){
    lines.push(`Often boh lui (no money), you share rice and stories to get through tight weeks.`);
  } else {
    lines.push(`You manage, neither rich nor ruined‚Äîone day at a time.`);
  }

  if(flags.borrowedFamily){
    lines.push(`Family debts ease slowly with each üßß remittance; gratitude travels farther than ships.`);
  }

  lines.push(`In this new place, some things change‚Äîlaws, overseers, faces‚Äîyet work‚Äôs weight remains.
You contribute with your hands: loads lifted, planks joined, a small temple raised. Not famous, but counted.`);

  document.getElementById('title').textContent = "Epilogue ‚Äî A Modest Life, Honestly Earned";
  document.getElementById('subtitle').textContent = "Change and continuity under British rule; brotherhood, law, and labour";
  document.getElementById('text').textContent = lines.join(' ');

  // Epilogue image
  setImageFor('epilogue');

  const summary = document.createElement('div');
  summary.className = 'hud';
  summary.innerHTML = `
    <div class="bars">
      <div class="bar"><label>Wealth üí∞</label><div class="track"><div class="fill wealth" style="width:${state.wealth*10}%"></div></div></div>
      <div class="bar"><label>Fatigue üòì</label><div class="track"><div class="fill fatigue" style="width:${state.fatigue*10}%"></div></div></div>
      <div class="bar"><label>Brotherhood ü§ù</label><div class="track"><div class="fill bro" style="width:${state.brotherhood*10}%"></div></div></div>
    </div>
  `;
  const choices = document.getElementById('choices');
  choices.innerHTML = '';

  const restart = document.createElement('button');
  restart.className = 'btn';
  restart.textContent = 'Restart ‚Äî Start the game';
  restart.addEventListener('click', ()=>resetGame());
  choices.appendChild(restart);

  document.querySelector('.hud').replaceWith(summary);
  document.getElementById('step').textContent = "Epilogue";
  document.getElementById('evNum').textContent = "6";
}

function resetGame(){
  state.wealth=2; state.fatigue=2; state.brotherhood=0;
  state.flags={usedAgent:false,borrowedFamily:false,job:null,joinedSociety:false,joinedKongsi:false,sentRemittance:false};
  renderEvent(1);
  const card = document.querySelector('.card');
  const newHud = document.createElement('div');
  newHud.className='hud';
  newHud.id='hud';
  newHud.innerHTML = `
    <div class="bars">
      <div class="bar"><label>Wealth üí∞</label><div class="track"><div class="fill wealth" id="wFill"></div></div></div>
      <div class="bar"><label>Fatigue üòì</label><div class="track"><div class="fill fatigue" id="fFill"></div></div></div>
      <div class="bar"><label>Brotherhood ü§ù</label><div class="track"><div class="fill bro" id="bFill"></div></div></div>
    </div>`;
  card.insertBefore(newHud, card.querySelector('.footer'));
  wFill = document.getElementById('wFill');
  fFill = document.getElementById('fFill');
  bFill = document.getElementById('bFill');
  setBars();
}

/* Keyboard shortcuts 1‚Äì4 */
window.addEventListener('keydown', (e)=>{
  const map = {'1':'0','2':'1','3':'2','4':'3'};
  if(map[e.key]!==undefined){
    const btn = document.querySelectorAll('.choices .option')[parseInt(map[e.key],10)];
    if(btn) btn.click();
  }
});

renderEvent(1);
setImageFor(1);
</script>
</body>
</html>
