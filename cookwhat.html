<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dinner Picker</title>
  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#090a12;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --muted2: rgba(255,255,255,.55);
      --accent: #7c5cff;
      --accent2:#2de2e6;
      --good:#2ee59d;
      --warn:#ffcc66;
      --bad:#ff5c7a;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius: 18px;
      --radius2: 14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(124,92,255,.22), transparent 55%),
        radial-gradient(1000px 700px at 90% 20%, rgba(45,226,230,.18), transparent 60%),
        radial-gradient(900px 700px at 50% 95%, rgba(46,229,157,.10), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    .wrap{
      max-width: 1120px;
      margin: 0 auto;
      padding: 28px 18px 44px;
    }

    header{
      display:flex;
      gap:16px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
      margin-bottom: 18px;
    }

    .brand{
      display:flex;
      gap:14px;
      align-items:center;
    }

    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(45,226,230,.88));
      box-shadow: 0 10px 35px rgba(124,92,255,.25);
      position:relative;
    }
    .logo:after{
      content:"";
      position:absolute; inset:10px;
      border-radius:10px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(8px);
    }

    h1{
      font-size: clamp(20px, 2.2vw, 28px);
      margin:0;
      letter-spacing:.2px;
    }
    .sub{
      margin:4px 0 0;
      color: var(--muted);
      font-size: 13.5px;
      line-height: 1.35;
      max-width: 58ch;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 16px;
      align-items:start;
    }
    @media (max-width: 920px){
      .grid{grid-template-columns: 1fr}
    }

    .card{
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,.04));
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .cardHead{
      padding: 16px 18px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    .pill{
      font-size:12px;
      color: var(--muted);
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      padding: 7px 10px;
      border-radius: 999px;
      display:inline-flex;
      gap:8px;
      align-items:center;
      user-select:none;
    }

    .main{
      padding: 18px;
    }

    .picker{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }

    .resultBox{
      position:relative;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.12);
      padding: 18px 16px;
      overflow:hidden;
    }

    .glow{
      position:absolute;
      inset:-40px -40px auto auto;
      width:220px; height:220px;
      background: radial-gradient(circle at 30% 30%, rgba(124,92,255,.42), transparent 60%),
                  radial-gradient(circle at 70% 60%, rgba(45,226,230,.28), transparent 58%);
      filter: blur(10px);
      opacity:.85;
      pointer-events:none;
      transform: translate3d(0,0,0);
    }

    .label{
      color: var(--muted);
      font-size: 12.5px;
      letter-spacing:.2px;
      margin-bottom: 8px;
    }

    .result{
      font-size: clamp(22px, 3.2vw, 36px);
      font-weight: 780;
      line-height: 1.1;
      letter-spacing: .2px;
      margin: 0;
      text-wrap: balance;
    }

    .slot{
      margin-top: 10px;
      font-family: var(--mono);
      font-size: 12.5px;
      color: var(--muted2);
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.10);
      height: 48px;
      display:flex;
      align-items:center;
      overflow:hidden;
      position:relative;
    }
    .slot span{
      white-space:nowrap;
      display:inline-block;
      transform: translateY(0);
    }
    .slot:after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(11,16,32,1), transparent 22%, transparent 78%, rgba(9,10,18,1));
      pointer-events:none;
      opacity:.95;
    }

    .controls{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      align-items:center;
      margin-top: 4px;
    }

    button{
      appearance:none;
      border:0;
      cursor:pointer;
      font-family: inherit;
      color: var(--text);
      font-weight: 650;
      padding: 12px 14px;
      border-radius: 14px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      transition: transform .08s ease, background .18s ease, border-color .18s ease;
      user-select:none;
    }
    button:hover{ background: rgba(255,255,255,.11); border-color: rgba(255,255,255,.18); }
    button:active{ transform: translateY(1px) scale(.99); }
    button:disabled{
      opacity:.45;
      cursor:not-allowed;
    }

    .primary{
      background: linear-gradient(135deg, rgba(124,92,255,.92), rgba(45,226,230,.74));
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 14px 40px rgba(124,92,255,.22);
    }
    .primary:hover{ filter: brightness(1.05); }
    .danger{
      background: rgba(255,92,122,.12);
      border-color: rgba(255,92,122,.24);
      color: rgba(255,255,255,.92);
    }

    .toggleRow{
      display:flex;
      flex-wrap:wrap;
      gap: 10px 14px;
      align-items:center;
      margin-top: 8px;
    }

    .toggle{
      display:flex;
      gap:10px;
      align-items:center;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--muted);
      font-size: 13px;
      user-select:none;
    }
    .toggle input{ width:18px; height:18px; accent-color: var(--accent); }

    .side{
      display:grid;
      gap: 16px;
    }

    .searchRow{
      display:flex;
      gap: 10px;
      align-items:center;
      padding: 14px 14px 0;
      flex-wrap:wrap;
    }
    input[type="text"]{
      flex:1;
      min-width: 220px;
      padding: 12px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.12);
      color: var(--text);
      outline:none;
    }
    input[type="text"]::placeholder{ color: rgba(255,255,255,.40); }

    .list{
      padding: 10px 14px 14px;
      display:grid;
      gap: 10px;
    }

    .item{
      padding: 12px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .item strong{
      font-size: 13.5px;
      font-weight: 700;
      letter-spacing:.1px;
    }
    .item small{
      display:block;
      color: var(--muted2);
      font-size: 11.5px;
      margin-top: 2px;
    }
    .miniBtns{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .miniBtns button{
      padding: 9px 10px;
      border-radius: 12px;
      font-size: 12.5px;
    }

    .history{
      padding: 14px;
      display:grid;
      gap: 10px;
    }
    .histRow{
      display:flex;
      gap: 10px;
      align-items:flex-start;
      justify-content:space-between;
      padding: 12px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
    }
    .histRow code{
      font-family: var(--mono);
      font-size: 11.5px;
      color: var(--muted2);
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.65);
      border: 1px solid rgba(255,255,255,.16);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      border-radius: 14px;
      box-shadow: 0 10px 35px rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      display:none;
      max-width: min(92vw, 680px);
      font-size: 13px;
    }

    footer{
      margin-top: 16px;
      color: rgba(255,255,255,.45);
      font-size: 12px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Dinner Picker</h1>
          <p class="sub">Tap the button, let randomness choose, and stop decision fatigue. You can temporarily remove dishes and avoid repeating the last pick.</p>
        </div>
      </div>
      <div class="pill" id="statsPill">üçΩÔ∏è <span id="statsText">0 options</span></div>
    </header>

    <div class="grid">
      <!-- LEFT: Picker -->
      <section class="card">
        <div class="cardHead">
          <div class="pill">üé≤ Random selector</div>
          <div class="pill">‚è±Ô∏è <span id="lastPickText">No pick yet</span></div>
        </div>

        <div class="main">
          <div class="picker">
            <div class="resultBox">
              <div class="glow" aria-hidden="true"></div>
              <div class="label">Tonight you‚Äôre having:</div>
              <h2 class="result" id="result">‚Äî</h2>
              <div class="slot" aria-live="polite" aria-label="Rolling options">
                <span id="slotText">Press ‚ÄúPick for me‚Äù.</span>
              </div>
            </div>

            <div class="controls">
              <button class="primary" id="pickBtn">Pick for me</button>
              <button id="copyBtn" disabled>Copy</button>
              <button class="danger" id="clearHistoryBtn">Clear history</button>
            </div>

            <div class="toggleRow">
              <label class="toggle">
                <input type="checkbox" id="noRepeatToggle" checked />
                No repeat (avoid last pick)
              </label>
              <label class="toggle">
                <input type="checkbox" id="soundToggle" />
                Tiny click sound
              </label>
            </div>

            <div class="pill" style="margin-top:10px;">
              Tip: remove dishes you‚Äôre not feeling today, then restore them later.
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT: Options + History -->
      <aside class="side">
        <section class="card">
          <div class="cardHead">
            <div class="pill">üìã Options</div>
            <div class="pill">‚úÖ Active: <span id="activeCount">0</span> ¬∑ üí§ Removed: <span id="removedCount">0</span></div>
          </div>

          <div class="searchRow">
            <input type="text" id="search" placeholder="Search dishes (e.g., prawn, mee, chicken)..." />
            <button id="restoreAllBtn">Restore all</button>
          </div>

          <div class="list" id="optionsList"></div>
        </section>

        <section class="card">
          <div class="cardHead">
            <div class="pill">üßæ History</div>
            <div class="pill">Last 10 picks</div>
          </div>
          <div class="history" id="history"></div>
        </section>
      </aside>
    </div>

    <footer>Made as a single-file GitHub page. Works offline. ‚ú®</footer>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ====== Your dinner options (de-duplicated automatically) ======
    const RAW_OPTIONS = [
      "Chicken soup",
      "Satay",
      "Slow pot chicken",
      "Mushroom soup",
      "Butter shrimp",
      "Crispy squid",
      "Popiah",
      "Chinese porridge",
      "Crepes",
      "Ikan Bakar",
      "Steamed egg",
      "Egg drop soup",
      "Shrimp cakes",
      "Wadeh wadeh",
      "Chicken soup and fish balls",
      "Egg sandwich",
      "Honey garlic chicken",
      "Grilled tuna cheese",
      "Steamed fish",
      "Tongseng (oxtail)",
      "Mushroom rice",
      "Gulai kambing (lamb curry) & Terung (eggplant)",
      "Glutinous rice w chicken",
      "Chicken rice",
      "Soto betawi",
      "Nasi lemak",
      "Mee siam",
      "Mee rebus",
      "Mee soto",
      "Mee bakso",
      "Ayam penyet",
      "Ayam bakar",
      "Mee goreng",
      "Beehoon goreng",
      "Nasi goreng",
      "Chinese fried rice",
      "Pad thai",
      "Oyster chicken",
      "Ayam rica rica",
      "Empal bakar (grilled beef)",
      "Lasagne",
      "Beehoon soup",
      "Steamboat",
      "Cik su‚Äôs beef steak",
      "Mexican food",
      "Deep fried fish",
      "Assam pedas",
      "Ikan bakar",              // duplicate with different casing; will be deduped
      "Mediterranean chicken",
      "Cereal prawn",
      "Hoisin chicken + Sambal Kang Kong",
      "Fried Crab",
      "steamed crab",            // casing normalised
      "Chicken karaage",
      "Chicken cutlet",
      "Sotong Bakar",
      "Ikan patin",
      "Cashew chicken",
      "Roast chicken",
      "Kungpao chicken",
      "Curry chicken",
      "Salted egg prawn"
      "Ayam Goreng Berempah"
    ];

    // ====== Helpers ======
    const $ = (sel) => document.querySelector(sel);
    const optionsListEl = $("#optionsList");
    const historyEl = $("#history");
    const resultEl = $("#result");
    const slotEl = $("#slotText");
    const pickBtn = $("#pickBtn");
    const copyBtn = $("#copyBtn");
    const clearHistoryBtn = $("#clearHistoryBtn");
    const restoreAllBtn = $("#restoreAllBtn");
    const searchEl = $("#search");
    const statsTextEl = $("#statsText");
    const activeCountEl = $("#activeCount");
    const removedCountEl = $("#removedCount");
    const lastPickTextEl = $("#lastPickText");
    const noRepeatToggle = $("#noRepeatToggle");
    const soundToggle = $("#soundToggle");
    const toastEl = $("#toast");

    const norm = (s) => s.trim().toLowerCase().replace(/\s+/g, " ");
    const titleCaseish = (s) => s.replace(/\s+/g, " ").trim();

    function showToast(msg){
      toastEl.textContent = msg;
      toastEl.style.display = "block";
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => toastEl.style.display = "none", 1800);
    }

    // Tiny click sound using WebAudio (optional)
    let audioCtx = null;
    function clickSound(){
      if(!soundToggle.checked) return;
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = "square";
      o.frequency.value = 740;
      g.gain.value = 0.03;
      o.connect(g); g.connect(audioCtx.destination);
      o.start();
      setTimeout(() => { o.stop(); }, 25);
    }

    // ====== State ======
    // De-dupe while keeping first-seen display string
    const dedupMap = new Map();
    for(const item of RAW_OPTIONS){
      const key = norm(item);
      if(!dedupMap.has(key)) dedupMap.set(key, titleCaseish(item));
    }
    const ALL = Array.from(dedupMap.values());

    const state = {
      removed: new Set(),     // store normed keys
      history: [],            // { item, at }
      lastPick: null,         // normed key
      rolling: false
    };

    function activeOptions(){
      return ALL.filter(item => !state.removed.has(norm(item)));
    }

    function filteredOptions(){
      const q = norm(searchEl.value || "");
      const list = ALL.filter(item => {
        const k = norm(item);
        const isRemoved = state.removed.has(k);
        // show both active and removed, but filter by query
        if(q && !k.includes(q)) return false;
        return true;
      });
      return list;
    }

    function updateStats(){
      const active = activeOptions().length;
      const removed = state.removed.size;
      statsTextEl.textContent = `${ALL.length} total ¬∑ ${active} active`;
      activeCountEl.textContent = active;
      removedCountEl.textContent = removed;
    }

    function renderOptions(){
      const list = filteredOptions();
      optionsListEl.innerHTML = "";

      if(list.length === 0){
        const empty = document.createElement("div");
        empty.className = "item";
        empty.innerHTML = `<div><strong>No matches</strong><small>Try a different keyword.</small></div>`;
        optionsListEl.appendChild(empty);
        return;
      }

      for(const item of list){
        const k = norm(item);
        const removed = state.removed.has(k);

        const row = document.createElement("div");
        row.className = "item";
        row.innerHTML = `
          <div>
            <strong>${escapeHtml(item)}</strong>
            <small>${removed ? "Removed (won‚Äôt be picked)" : "Active"}</small>
          </div>
          <div class="miniBtns">
            <button data-action="${removed ? "restore" : "remove"}" data-key="${k}">
              ${removed ? "Restore" : "Remove"}
            </button>
          </div>
        `;
        optionsListEl.appendChild(row);
      }

      optionsListEl.querySelectorAll("button[data-action]").forEach(btn => {
        btn.addEventListener("click", () => {
          const action = btn.getAttribute("data-action");
          const key = btn.getAttribute("data-key");
          if(action === "remove") state.removed.add(key);
          else state.removed.delete(key);

          updateStats();
          renderOptions();
          // If everything removed, warn
          if(activeOptions().length === 0) showToast("All options removed ‚Äî restore some!");
        });
      });
    }

    function renderHistory(){
      historyEl.innerHTML = "";
      const last10 = state.history.slice(0, 10);

      if(last10.length === 0){
        const empty = document.createElement("div");
        empty.className = "histRow";
        empty.innerHTML = `<div><strong style="font-size:13.5px;">No history yet</strong><div style="color:rgba(255,255,255,.55);font-size:12px;margin-top:2px;">Your picks will show up here.</div></div>`;
        historyEl.appendChild(empty);
        return;
      }

      for(const h of last10){
        const row = document.createElement("div");
        row.className = "histRow";
        row.innerHTML = `
          <div>
            <div style="font-weight:720;">${escapeHtml(h.item)}</div>
            <code>${new Date(h.at).toLocaleString()}</code>
          </div>
          <button data-repick="${escapeHtmlAttr(h.item)}" title="Set as current result">Use</button>
        `;
        historyEl.appendChild(row);
      }

      historyEl.querySelectorAll("button[data-repick]").forEach(btn => {
        btn.addEventListener("click", () => {
          const item = btn.getAttribute("data-repick");
          setResult(item, false);
          showToast("Set result from history.");
        });
      });
    }

    function setResult(item, pushHistory=true){
      resultEl.textContent = item;
      copyBtn.disabled = !item || item === "‚Äî";

      const k = norm(item);
      state.lastPick = k;
      lastPickTextEl.textContent = `Last pick: ${item}`;

      if(pushHistory){
        state.history.unshift({ item, at: Date.now() });
        if(state.history.length > 50) state.history.pop();
        renderHistory();
      }
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, s => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[s]));
    }
    function escapeHtmlAttr(str){
      return escapeHtml(str).replace(/"/g, "&quot;");
    }

    // Rolling animation that "spins" through options
    async function pickDinner(){
      if(state.rolling) return;

      const active = activeOptions();
      if(active.length === 0){
        showToast("Restore some options first.");
        return;
      }

      // Build candidate list respecting no-repeat
      let candidates = active.slice();
      if(noRepeatToggle.checked && state.lastPick && candidates.length > 1){
        candidates = candidates.filter(x => norm(x) !== state.lastPick);
      }

      if(candidates.length === 0){
        // edge case: only one item and it's the last pick
        candidates = active.slice();
      }

      // Start rolling
      state.rolling = true;
      pickBtn.disabled = true;
      copyBtn.disabled = true;

      const spins = Math.min(42, 18 + candidates.length); // feels snappy even with many items
      let current = candidates[Math.floor(Math.random() * candidates.length)];
      slotEl.textContent = "Rolling‚Ä¶";

      for(let i=0;i<spins;i++){
        current = candidates[Math.floor(Math.random() * candidates.length)];
        slotEl.textContent = `${current}   ¬∑   ${candidates[Math.floor(Math.random() * candidates.length)]}   ¬∑   ${candidates[Math.floor(Math.random() * candidates.length)]}`;
        clickSound();

        // Ease-out: slow down as i increases
        const t = i / (spins - 1);
        const delay = 18 + Math.floor(130 * t * t);
        await sleep(delay);
      }

      // Final choice (crypto-strong randomness if available)
      const finalPick = secureRandomPick(candidates);
      slotEl.textContent = `Selected: ${finalPick}`;
      setResult(finalPick, true);

      pickBtn.disabled = false;
      copyBtn.disabled = false;
      state.rolling = false;
    }

    function secureRandomPick(arr){
      // Use crypto if available; fallback to Math.random
      const n = arr.length;
      if(n <= 1) return arr[0];

      if(window.crypto && crypto.getRandomValues){
        // Rejection sampling to avoid modulo bias
        const max = 0xFFFFFFFF;
        const limit = max - (max % n);
        const buf = new Uint32Array(1);
        while(true){
          crypto.getRandomValues(buf);
          const x = buf[0];
          if(x < limit) return arr[x % n];
        }
      }
      return arr[Math.floor(Math.random() * n)];
    }

    function sleep(ms){ return new Promise(res => setTimeout(res, ms)); }

    async function copyResult(){
      const text = resultEl.textContent.trim();
      if(!text || text === "‚Äî") return;

      try{
        await navigator.clipboard.writeText(text);
        showToast("Copied to clipboard.");
      }catch{
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        showToast("Copied.");
      }
    }

    function clearHistory(){
      state.history = [];
      renderHistory();
      showToast("History cleared.");
    }

    function restoreAll(){
      state.removed.clear();
      updateStats();
      renderOptions();
      showToast("All options restored.");
    }

    // ====== Wire up ======
    pickBtn.addEventListener("click", pickDinner);
    copyBtn.addEventListener("click", copyResult);
    clearHistoryBtn.addEventListener("click", clearHistory);
    restoreAllBtn.addEventListener("click", restoreAll);

    searchEl.addEventListener("input", () => renderOptions());

    // Initial render
    updateStats();
    renderOptions();
    renderHistory();
  </script>
</body>
</html>
